<!DOCTYPE html>

{% extends "exchange_app/base.html" %}
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Ticker</title>
    <script type="text/javascript" src="ticker_detail.js"></script>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ"
      crossorigin="anonymous"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter&family=Raleway&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/templates/exchange_app/css/normalize.css" />
    <link rel="stylesheet" href="/templates/exchange_app/css/styles_2.css" />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe"
      crossorigin="anonymous"
    ></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
  </head>

  {% block body_block %}

  <body>
    <nav class="nav grid--1x3">
      <div class="logo">
        <img
          class="logo--img"
          src="/static/exchange_app/fbx_logo.jpeg"
          alt=""
        />
        <span class="logo--span">FBX</span>
      </div>

      <div class="nav--list">
        <ul class="list">
          <li class="list--item list--inline">Admin</li>
          <li class="list--item list--inline">Games</li>
          <li class="list--item list--inline">Sports</li>
        </ul>
      </div>

      <div class="nav--btn">
        <!-- <button class="btn btn--primary btn--radius">PERSONAL</button>
         <span style="color:#fff">|</span> -->
        <button class="btn--copy btn--secondary btn--radius">PERSONAL</button>
      </div>
    </nav>

    <div class="grid grid--1x3">
      <div class="empty"></div>
      <div class="ticker-info-middle-column">
        <div class="ticker-info-game-stat">
          <h2 class="ticker__team">Boston Celtics @ Miami Heat</h2>
          <!-- Middle Section that includes that ticker, status, score and volume -->
          <div class="grid grid--1x4">
            <h3 class="ticker__team">Current Score: 8</h3>
            <h3 class="ticker__team">Status: Open</h3>
            <h3 class="ticker__team">Last Price: 4.00</h3>
            <h3 class="ticker__team">Volume: 25</h3>
          </div>
        </div>

        <!-- Middle Sectiont including Graph,Orderbook and Order Submisson Field  -->
        <div class="ticker-info-trading">
          <div class="grid grid--1x3 grid-trading">
            <div class="ticker-info-ob">
              <!-- TradingView Widget BEGIN -->
              <!-- TradingView Widget BEGIN -->
              <div class="tradingview-widget-container">
                <div
                  class="tradingview-widget-container"
                  id="tradingview_8efd8"
                ></div>

                <script
                  type="text/javascript"
                  src="https://s3.tradingview.com/tv.js"
                ></script>
                <script type="text/javascript">
                  new TradingView.widget({
                    // width: 300,
                    // height: 300,
                    autosize: true,
                    symbol: "NASDAQ:AAPL",
                    interval: "D",
                    timezone: "Etc/UTC",
                    theme: "dark",
                    style: "1",
                    locale: "en",
                    enable_publishing: false,
                    allow_symbol_change: true,
                    container_id: "tradingview_8efd8",
                  });
                </script>
              </div>
              <!-- TradingView Widget END -->
              <!-- <!-- TradingView Widget END -->
            </div>

            <!-- <div class="ticker-info-ob">
              <h3 class="place-order-header">Orderbook</h3>
            </div> -->

            <div class="ticker-info-ob">
              <div class="row m-2 orderbook sell-orderbook">
                <h3 class="place-order-header">Orderbook</h3>

                <table class="table text-white">
                  <thead>
                    <tr>
                      <th>Price</th>
                      <th>Quantity</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for sell_order in sell_orders %}
                    <tr>
                      <td class="text-danger">{{ sell_order.price }}</td>
                      <td>{{ sell_order.total_quantity }}</td>
                    </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
              <div class="row m-2 orderbook buy-orderbook">
                <!-- Display Buy Orders -->
                <table class="table text-white">
                  <thead>
                    <tr>
                      <th>Price</th>
                      <th>Quantity</th>
                    </tr>
                  </thead>
                  <!-- <tbody>
                    {% for buy_order in buy_orders %}
                    <tr>
                      <td class="text-success">{{ buy_order.price }}</td>
                      <td>{{ buy_order.total_quantity }}</td>
                    </tr>
                    {% endfor %}
                  </tbody> -->
                </table>
              </div>
            </div>

            <div class="ticker-info-ob">
              <h3 class="place-order-header">Place Order</h3>
              <div class="grid grid--5x2">
                <p class="place-order-fields PO1">Order Type</p>
                <p class="place-order-fields PO2">Side</p>
                <p class="place-order-fields PO3">Price</p>
                <p class="place-order-fields PO4">Quantity</p>
                <form class="form__order-type">
                  <select name="" id="form__order-type">
                    <option value="Market">Market</option>
                    <option value="Limit">Limit</option>
                  </select>
                </form>
                <form class="form__order-side">
                  <select name="" id="form__order-side">
                    <option value="Buy">BUY</option>
                    <option value="Sell">SELL</option>
                  </select>
                </form>

                <div class="form__input form__order-price">
                  <input
                    type="text"
                    name=""
                    id=""
                    class="input"
                    placeholder=""
                  />
                </div>

                <div class="form__input form__order-qty">
                  <input
                    type="text"
                    name=""
                    id=""
                    class="input"
                    placeholder=""
                  />
                </div>

                <button
                  class="btn--copy btn--order btn--primary place-order-fields PO5"
                >
                  Submit Order
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Middle Sectiont that inlcudes the Orders-,Fills-, Position and Historic Tables -->
        <div class="grid grid--1x5">
          <h4>Orders</h4>
          <h4>Fills</h4>
          <h4>Positions</h4>
          <h4>Historic Orders</h4>
        </div>
        <div style="border-top: 1px solid var(--color-border)"></div>

        <!-- Tables  -->
        {% if user.is_authenticated %}
        <div id="orders-section" class="tables__order-detail">
          {% if user_orders %}
          <!-- Iterate over user_orders and display order information -->
          <table class="table mt-4 mb-4 table-white text-white">
            <thead>
              <tr>
                <th>Timestamp</th>
                <th>Order Type</th>
                <th>Side</th>
                <th>Price</th>
                <th>Quantity</th>
                <th>Filled Quantity</th>
                <th>Working Quantity</th>
                <th>Avg Fill Price</th>
                <th>Status</th>
                <th>Paid Fees</th>
                <th>Cancel</th>
              </tr>
            </thead>
            <tbody>
              {% for order in user_orders %}
              <tr>
                <td>{{ order.creation_timestamp }}</td>
                <td>{{ order.order_type }}</td>
                <td>{{ order.side }}</td>
                <td>{{ order.price }}</td>
                <td>{{ order.quantity }}</td>
                <td>{{ order.filled_quantity }}</td>
                <td>{{ order.working_quantity }}</td>
                <td>{{ order.avg_fill_price }}</td>
                <td>{{ order.status }}</td>
                <td>{{ order.paid_fees }}</td>
                <td>
                  <button type="submit" class="btn btn-warning">CANCEL</button>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
          {% else %}
          <p>No orders available.</p>
          {% endif %}
        </div>
        <div id="positions-section">
          {% if user_positions %}
          <table class="table mt-4 mb-4 table-white text-white">
            <thead>
              <tr>
                <th>Ticker</th>
                <th>Position</th>
                <th>Avg Price</th>
                <th>Open Pnl</th>
                <th>Closed PnL</th>
              </tr>
            </thead>
            <tbody>
              {% for position in user_positions %}
              <tr>
                <td>{{ position.ticker.ticker_id }}</td>
                <td>{{ position.quantity }}</td>
                <td>{{ position.average_price }}</td>
                <td>{{ position.open_pnl }}</td>
                <td>{{ position.closed_pnl }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
          {% else %}
          <p>No positions available.</p>
          {% endif %}
        </div>
        <div id="fills-section">
          {% comment %} DISPLAY POSITIONS OF THE USER {% endcomment %} {% if
          user_fills %}
          <!-- Iterate over user_POSITIONS and display order information -->
          <table class="table mt-4 mb-4 table-white text-white">
            <thead>
              <tr>
                <th>Timestamp</th>
                <th>Ticker</th>
                <th>Side</th>
                <th>Quantity</th>
                <th>Price</th>
              </tr>
            </thead>
            <tbody>
              {% for fill in user_fills %}
              <tr>
                <td>{{ fill.timestamp }}</td>
                <td>{{ fill.ticker.ticker_id }}</td>
                <td>{{ fill.side }}</td>
                <td>{{ fill.quantity }}</td>
                <td>{{ fill.price }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
          {% else %}
          <p>No fills available.</p>
          {% endif %}
        </div>
        {% else %}
        <p>Log in to display data</p>
        {% endif %}

        <!-- Tables End -->
      </div>
      <div class="empty"></div>
    </div>

    <div class="footer"></div>
  </body>
  {% endblock %}
</html>
